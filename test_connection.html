<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Test p≈ôipojen√≠ k Home Assistant</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #fff;
        }
        .error { color: #ff4444; }
        .success { color: #44ff44; }
        .warning { color: #ffaa00; }
        pre {
            background: #000;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîç Test p≈ôipojen√≠ k Home Assistant</h1>
    <div id="output"></div>

    <script>
        // ZKOP√çRUJTE SEM KONFIGURACI Z crypto_ticker.html
        const HA_URL = "http://192.168.1.1:8123";  // ‚Üê ZMƒö≈áTE!
        const HA_TOKEN = "Tvoje dlouhodob√© API token";  // ‚Üê ZMƒö≈áTE!

        const output = document.getElementById('output');

        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = msg;
            output.appendChild(div);
        }

        async function testConnection() {
            log('<h2>Zaƒç√≠n√°m test...</h2>');

            // Test 1: Konfigurace
            log('<h3>1Ô∏è‚É£ Kontrola konfigurace:</h3>');
            if (HA_URL === "http://192.168.1.1:8123") {
                log('‚ùå HA_URL nen√≠ zmƒõnƒõna!', 'error');
            } else {
                log(`‚úÖ HA_URL: <code>${HA_URL}</code>`, 'success');
            }

            if (HA_TOKEN === "Tvoje dlouhodob√© API token") {
                log('‚ùå HA_TOKEN nen√≠ nastaven!', 'error');
                return;
            } else {
                log(`‚úÖ HA_TOKEN zaƒç√≠na: <code>${HA_TOKEN.substring(0, 20)}...</code>`, 'success');
                log(`   Token d√©lka: ${HA_TOKEN.length} znak≈Ø`, 'info');

                // Kontrola mezer/nov√Ωch ≈ô√°dk≈Ø
                if (HA_TOKEN.includes(' ') || HA_TOKEN.includes('\n') || HA_TOKEN.includes('\t')) {
                    log('‚ö†Ô∏è VAROV√ÅN√ç: Token obsahuje mezery nebo nov√© ≈ô√°dky!', 'warning');
                }
            }

            // Test 2: Pokus o p≈ôipojen√≠
            log('<h3>2Ô∏è‚É£ Test p≈ôipojen√≠ k API:</h3>');
            log(`Pokou≈°√≠m se p≈ôipojit na: <code>${HA_URL}/api/</code>`);

            try {
                const testUrl = `${HA_URL}/api/`;
                log(`Pos√≠l√°m GET po≈æadavek...`);

                const response = await fetch(testUrl, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${HA_TOKEN}`,
                        'Content-Type': 'application/json'
                    }
                });

                log(`<br>üìä <b>HTTP Status:</b> ${response.status} ${response.statusText}`);

                if (response.status === 200) {
                    const data = await response.json();
                    log('‚úÖ P≈òIPOJEN√ç √öSPƒö≈†N√â!', 'success');
                    log('<pre>' + JSON.stringify(data, null, 2) + '</pre>');
                } else if (response.status === 401) {
                    log('‚ùå CHYBA 401: Neplatn√Ω token!', 'error');
                    log('Zkontrolujte:', 'error');
                    log('  ‚Ä¢ ≈Ωe jste zkop√≠rovali cel√Ω token', 'error');
                    log('  ‚Ä¢ ≈Ωe token nen√≠ expirovan√Ω', 'error');
                    log('  ‚Ä¢ ≈Ωe jste token nevytvo≈ôili pro jin√Ω HA instance', 'error');

                    try {
                        const errorText = await response.text();
                        log('<pre>' + errorText + '</pre>');
                    } catch(e) {}
                } else if (response.status === 403) {
                    log('‚ùå CHYBA 403: Nedostateƒçn√° opr√°vnƒõn√≠!', 'error');
                } else {
                    log(`‚ùå Neoƒçek√°van√Ω status: ${response.status}`, 'error');
                    try {
                        const errorText = await response.text();
                        log('<pre>' + errorText + '</pre>');
                    } catch(e) {}
                }

            } catch (error) {
                log('‚ùå CHYBA P≈òIPOJEN√ç:', 'error');
                log(error.message, 'error');
                log('<br>Mo≈æn√© p≈ô√≠ƒçiny:', 'warning');
                log('  ‚Ä¢ Home Assistant nebƒõ≈æ√≠', 'warning');
                log('  ‚Ä¢ ≈†patn√° URL adresa', 'warning');
                log('  ‚Ä¢ CORS nen√≠ nakonfigurov√°n', 'warning');
                log('  ‚Ä¢ Firewall blokuje spojen√≠', 'warning');
            }

            // Test 3: Pokus naƒç√≠st konkr√©tn√≠ sensor
            log('<h3>3Ô∏è‚É£ Test naƒçten√≠ crypto sensoru:</h3>');
            try {
                const sensorUrl = `${HA_URL}/api/states/sensor.crypto_bitcoin`;
                log(`Zkou≈°√≠m naƒç√≠st: <code>${sensorUrl}</code>`);

                const response = await fetch(sensorUrl, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${HA_TOKEN}`,
                        'Content-Type': 'application/json'
                    }
                });

                log(`<br>üìä <b>HTTP Status:</b> ${response.status}`);

                if (response.status === 200) {
                    const data = await response.json();
                    log('‚úÖ Sensor nalezen!', 'success');
                    log('<pre>' + JSON.stringify(data, null, 2) + '</pre>');
                } else if (response.status === 404) {
                    log('‚ö†Ô∏è Sensor crypto_bitcoin neexistuje', 'warning');
                    log('Mus√≠te nainstalovat Crypto Info integraci:', 'warning');
                    log('<a href="https://github.com/heyajohnny/cryptoinfo" target="_blank">https://github.com/heyajohnny/cryptoinfo</a>', 'info');
                } else if (response.status === 401) {
                    log('‚ùå St√°le chyba 401 - token je urƒçitƒõ ≈°patnƒõ!', 'error');
                } else {
                    log(`Status: ${response.status}`, 'warning');
                }

            } catch (error) {
                log('‚ùå Chyba: ' + error.message, 'error');
            }
        }

        // Spustit test
        testConnection();
    </script>
</body>
</html>
